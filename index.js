const mainDOM={sectionsClass:"observe-section",navClass:"naviscroll"},defaultProps={subsections:!0,createLinks:!0,setSectionIds:!0,appendTo:"",sectionsClass:`.${mainDOM.sectionsClass}`,sectionHeadingClass:`.${mainDOM.sectionsClass}__heading`,buildNav:!0,onSectionBuild:({sectionEl:e,navSectionEl:t,parent:n,depth:s})=>{},navTag:"nav",navClass:mainDOM.navClass,navSectionClass:`${mainDOM.navClass}__section`,navSubSectionClass:`${mainDOM.navClass}__sub-section`,navListType:"ul",navSectionTag:"li",idString:"",idSeparator:"-",observe:!0,onSectionIn:({sectionEl:e,navEl:t,id:n,depth:s})=>{},onSectionOut:({sectionEl:e,navEl:t,id:n,depth:s})=>{},rootMargin:"-50% 0px -50% 0px",observerRoot:null};class Naviscroll{constructor(e,t){const n="object"==typeof t?t:{};this.props={...defaultProps,...n},this.sectionsContainer="string"==typeof e?document.querySelector(e):e,this.init()}goOverSections(e,t){if(!e)return;const{sectionsClass:n,idSeparator:s,idString:o,subsections:i}=this.props,{sectionEl:a,id:c,navEl:r,depth:l=-1}=e,d=a.querySelectorAll(`:scope > ${n}`);0!==d.length&&d.forEach((e,n)=>{const a={sectionEl:e,id:c?`${c}${s}${n+1}`:`${o?o+s:o}${n+1}`,navEl:r,depth:l+1};t&&(a.navEl=t(a)),i&&this.goOverSections(a,t)})}buildNavSection(e,t){const{navEl:n,id:s,sectionEl:o,depth:i}=e,{navSectionClass:a,navSubSectionClass:c,navListType:r,navSectionTag:l,sectionHeadingClass:d,createLinks:p,setSectionIds:v}=this.props,u=document.createElement(l);u.className=`\n        ${a}\n     `;const h=getSectionHeading({sectionEl:o,sectionHeadingClass:d});if(p&&v){const e=document.createElement("a");e.href=`#${s}`,e.textContent=h,u.appendChild(e)}else u.textContent=h;if(n){const e=getSubsectionContainer(n,r);if(e)e.appendChild(u);else{const e=document.createElement(r);e.className=c,e.dataset.depth=i,e.appendChild(u),n.appendChild(e)}}else this.navWrapper.appendChild(u);return t({sectionEl:o,navSectionEl:u,navElParent:n,depth:i}),u}buildNav(){const{navClass:e,appendTo:t,navTag:n,navListType:s}=this.props;this.navEl=document.createElement(n),this.navEl.className=e;const{navEl:o,sectionsContainer:i}=this;this.navWrapper=document.createElement(s),this.navWrapper.className=`${e}__wrapper`,t?"string"==typeof t?document.querySelector(t):t.appendChild(o):i.parentElement.insertBefore(o,i)}toggleActiveSection({navEl:e},t){const{navSectionClass:n}=this.props,s=`${n}--active`;e.classList[t](s)}init(){const{buildNav:e,setSectionIds:t}=this.props;e&&this.buildNav();const{onSectionBuild:n,onSectionIn:s,onSectionOut:o,observe:i,rootMargin:a,observerRoot:c}=this.props;this.goOverSections({sectionEl:this.sectionsContainer},r=>(t&&setElementId(r),i&&sectionObserver({onSectionIn:()=>{s(r),e&&this.toggleActiveSection(r,"add")},onSectionOut:()=>{o(r),e&&this.toggleActiveSection(r,"remove")},rootMargin:a,root:c}).observe(r.sectionEl),e?this.buildNavSection(r,n):null)),e&&this.navEl.appendChild(this.navWrapper)}}function setElementId(e){const{sectionEl:t,id:n}=e;t.id=n}function getSectionHeading({sectionEl:e,sectionHeadingClass:t}){if(t){const n=e.querySelector(t);return e.dataset.heading?e.dataset.heading:n.textContent}return e.dataset.heading}function getSubsectionContainer(e,t){return e.querySelector(`:scope > ${t}`)}function sectionObserver({onSectionIn:e,onSectionOut:t,rootMargin:n,root:s}){return new IntersectionObserver(n=>{n.forEach(n=>{n.isIntersecting?e():t()})},{root:s,rootMargin:n})}export default function naviscroll(e,t){return new Naviscroll(e,t)}